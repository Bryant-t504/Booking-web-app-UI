<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Ticket - BookFlight</title>
  <link rel="stylesheet" href="results.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <div class="background">
    <div class="booking-container" id="ticketContainer">
      <h2>Your Travel Ticket</h2>
      <div id="ticketDetails"></div>

      <div style="margin-top: 1.5rem; display: flex; flex-direction: column; gap: 1rem;">
        <button id="downloadBtn" class="search-btn">Download Ticket (PDF)</button>
        <button id="homeBtn" class="search-btn" style="background: #fff; color: #333;">Go Back Home</button>
      </div>
    </div>
  </div>

  <script>
    const ticketData = JSON.parse(localStorage.getItem('bookedTicket'));
    const detailsDiv = document.getElementById('ticketDetails');
    const btn = document.getElementById('downloadBtn');
    const homeBtn = document.getElementById('homeBtn');

    if (!ticketData) {
      detailsDiv.innerHTML = '<p>No ticket found. Please book again.</p>';
      btn.style.display = 'none';
      homeBtn.style.display = 'none';
    } else {
      const b = ticketData.bookingSummary;
      const date = new Date(ticketData.bookedAt).toLocaleString();

      // --- Create QR code text ---
      const qrText = `
        Trip: ${b.type.toUpperCase()}
        From: ${b.departure}
        To: ${b.destination}
        Departure: ${b.departDate}
        Class: ${ticketData.class}
        Price: $${ticketData.price}
        Passengers: ${b.adults} Adults, ${b.children} Children
        Ticket ID: #${Math.floor(Math.random()*1000000)}
      `.trim();

      const qrCodeURL = `https://api.qrserver.com/v1/create-qr-code/?size=140x140&data=${encodeURIComponent(qrText)}`;

      detailsDiv.innerHTML = `
        <div id="ticketCard" style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 10px;">
          <h3 style="color:#0066ff; margin-bottom: .5rem;">${b.type.toUpperCase()} Ticket</h3>
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div style="flex:1; color:#000;">
              <p><strong>Passenger(s):</strong> ${b.adults} Adult(s), ${b.children} Child(ren)</p>
              <p><strong>From:</strong> ${b.departure}</p>
              <p><strong>To:</strong> ${b.destination}</p>
              <p><strong>Departure Date:</strong> ${b.departDate}</p>
              ${b.returnDate ? `<p><strong>Return Date:</strong> ${b.returnDate}</p>` : ''}
              <p><strong>Class:</strong> ${ticketData.class}</p>
              <p><strong>Total Price:</strong> $${ticketData.price}</p>
            </div>
            <div style="margin-left:1rem;">
              <img src="${qrCodeURL}" alt="QR Code" style="border-radius:8px; background:#fff; padding:4px;">
            </div>
          </div>
          <hr style="margin:1rem 0; border-color:rgba(255,255,255,0.3)">
          <p><strong>Booking Time:</strong> ${date}</p>
          <p><strong>Ticket ID:</strong> #${Math.floor(Math.random()*1000000)}</p>
          <p>âœ… <strong>Status:</strong> Confirmed</p>
        </div>
      `;

      // --- Download Ticket ---
      btn.onclick = () => {
        const element = document.getElementById('ticketCard');
        const opt = {
          margin: 0.5,
          filename: 'BookFlight_Ticket.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
        };
        html2pdf().set(opt).from(element).save();
      };

      // --- Go Home ---
      homeBtn.onclick = () => {
        window.location.href = 'index.html';
      };
    }
  </script>
</body>
</html>
